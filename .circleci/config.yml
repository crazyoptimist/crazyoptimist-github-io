version: 2.1
orbs:
  firebase-deploy: azdevs/firebase-deploy@1.0.0
  hugo: circleci/hugo@1.3.0

jobs:
  build:
    docker:
      - image: cibuilds/hugo
    steps:
      - checkout
      - hugo/install:
          version: 0.108.0
      - run:
          name: Install Hugo Modules(Including Theme)
          command: hugo mod tidy
      - hugo/hugo-build:
          extra-flags: '--gc --minify'
      - persist_to_workspace:
          root: ~/project
          paths:
            - public
            - resources

  deploy:
    docker:
      - image: 'cimg/node:lts'
    steps:
      - checkout
      - attach_workspace:
          at: ~/project
      - firebase-deploy/deploy:
          token: '$FIREBASE_TOKEN'
          alias: 'crazyoptimist-net'
workflows:
  build-and-deploy:
    jobs:
      - build
      - deploy:
          requires:
            - build
